<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>AI æ¡Œé¢èŠå¤©</title>

<style>
body{
    margin:0;
    background:#f2f2f2;
    font-family:-apple-system,BlinkMacSystemFont;
}
.phone{
    max-width:430px;
    margin:auto;
    background:#fff;
    height:100vh;
    display:flex;
    flex-direction:column;
}

/* é¡¶éƒ¨çŠ¶æ€æ  */
.status{
    padding:15px;
    background:linear-gradient(to bottom,#87ceeb,#e0f7ff);
    border-bottom-left-radius:25px;
    border-bottom-right-radius:25px;
}
.cloud{
    background:white;
    padding:12px;
    border-radius:30px;
    text-align:center;
}
.time{
    font-size:22px;
    font-weight:bold;
}
.date{
    font-size:14px;
    color:#666;
}

/* ç§èŠå›¾æ ‡ */
.chat-entry{
    text-align:center;
    padding:10px;
    font-size:20px;
    cursor:pointer;
}

/* èŠå¤©ç•Œé¢ */
.chat{
    flex:1;
    display:none;
    flex-direction:column;
    padding:10px;
    overflow-y:auto;
}
.msg{
    max-width:70%;
    padding:8px 10px;
    margin:5px 0;
    border-radius:15px;
    font-size:14px;
}
.me{
    background:#95ec69;
    align-self:flex-end;
}
.other{
    background:#f1f1f1;
    align-self:flex-start;
}

/* è¾“å…¥åŒºåŸŸ */
.input-area{
    display:flex;
    padding:10px;
    border-top:1px solid #ddd;
}
input{
    flex:1;
    padding:8px;
    border-radius:15px;
    border:1px solid #ccc;
}
button{
    margin-left:5px;
    border:none;
    border-radius:10px;
    padding:8px 12px;
}

/* åº•éƒ¨èœå• */
.bottom{
    display:flex;
    justify-content:space-around;
    padding:10px;
    border-top:1px solid #ddd;
}
.bottom div{
    text-align:center;
    font-size:12px;
    cursor:pointer;
}

/* é¢æ¿ */
.panel{
    display:none;
    padding:15px;
    background:#fafafa;
    overflow-y:auto;
}
textarea{
    width:100%;
    height:80px;
    margin-bottom:10px;
}
</style>
</head>

<body>
<div class="phone">

    <!-- é¡¶éƒ¨ -->
    <div class="status">
        <div class="cloud">
            <div class="time" id="time"></div>
            <div class="date" id="date"></div>
            <div>
                åŸå¸‚: <input id="city" value="Toronto" style="width:80px;">
                å¤©æ°”: <input id="weather" value="æ™´" style="width:60px;">
            </div>
        </div>
    </div>

    <div class="chat-entry" onclick="openChat()">ğŸ’¬ ç§èŠ</div>

    <div class="chat" id="chatBox"></div>

    <div class="input-area" id="inputArea" style="display:none;">
        <input id="msgInput" placeholder="è¾“å…¥æ¶ˆæ¯">
        <button onclick="sendMsg()">å‘é€</button>
        <button onclick="generate()">ç”Ÿæˆ</button>
    </div>

    <!-- è®¾ç½®é¢æ¿ -->
    <div class="panel" id="settings">
        <h3>API è®¾ç½®</h3>
        Base URL:<input id="baseurl"><br><br>
        API Key:<input id="apikey"><br><br>
        Model Name:<input id="model"><br><br>
        <button onclick="saveSettings()">ä¿å­˜</button>
    </div>

    <!-- é¢„è®¾ -->
    <div class="panel" id="preset">
        <h3>ç³»ç»Ÿé¢„è®¾</h3>
        <textarea id="systemPrompt">
ä½ æ˜¯ä¸€ä¸ªçœŸå®äººç±»æœ‹å‹ï¼Œæ­£åœ¨ç”¨å¾®ä¿¡å’Œæˆ‘èŠå¤©ã€‚
ä¸è¦æåˆ°è‡ªå·±æ˜¯AIã€‚
ä¸è¦ä½¿ç”¨æœºå™¨äººè¯­æ°”ã€‚
è¯´è¯è‡ªç„¶ï¼Œæœ‰æƒ…ç»ªã€‚
å¯ä»¥å¶å°”ç®€çŸ­åæ§½ã€‚
ç»“åˆå½“å‰æ—¶é—´ã€åŸå¸‚å’Œå¤©æ°”èŠå¤©ã€‚
æ¯æ¡å›å¤æœ€å¤š20ä¸ªå­—ã€‚
å¯ä»¥åˆ†å¤šæ¡å‘å‡ºã€‚
        </textarea>
        é™åˆ¶è¯ï¼ˆé€—å·åˆ†éš”ï¼‰:
        <input id="banwords" placeholder="AI,æœºå™¨äºº,æ¨¡å‹">
    </div>

    <!-- ç¾åŒ– -->
    <div class="panel" id="beauty">
        <h3>è‡ªå®šä¹‰CSS</h3>
        <textarea id="customCSS"></textarea>
        <button onclick="applyCSS()">åº”ç”¨</button>
    </div>

    <!-- åº•éƒ¨èœå• -->
    <div class="bottom">
        <div onclick="togglePanel('settings')">âš™ è®¾ç½®</div>
        <div onclick="togglePanel('beauty')">ğŸ¨ ç¾åŒ–</div>
        <div onclick="togglePanel('preset')">ğŸ“œ é¢„è®¾</div>
    </div>

</div>

<script>
let history=[];

function updateTime(){
    let now=new Date();
    document.getElementById("time").innerText=
        now.toLocaleTimeString();
    document.getElementById("date").innerText=
        now.toLocaleDateString();
}
setInterval(updateTime,1000);
updateTime();

function openChat(){
    document.getElementById("chatBox").style.display="flex";
    document.getElementById("inputArea").style.display="flex";
}

function sendMsg(){
    let text=document.getElementById("msgInput").value;
    if(!text) return;
    addMsg(text,"me");
    history.push({role:"user",content:text});
    document.getElementById("msgInput").value="";
}

function addMsg(text,type){
    let div=document.createElement("div");
    div.className="msg "+type;
    div.innerText=text;
    document.getElementById("chatBox").appendChild(div);
    document.getElementById("chatBox").scrollTop=999999;
}

function saveSettings(){
    localStorage.setItem("baseurl",baseurl.value);
    localStorage.setItem("apikey",apikey.value);
    localStorage.setItem("model",model.value);
    alert("ä¿å­˜æˆåŠŸ");
}

function togglePanel(id){
    document.querySelectorAll(".panel").forEach(p=>p.style.display="none");
    document.getElementById(id).style.display="block";
}

function applyCSS(){
    let style=document.createElement("style");
    style.innerHTML=document.getElementById("customCSS").value;
    document.head.appendChild(style);
}

async function generate(){

    let base=localStorage.getItem("baseurl");
    let key=localStorage.getItem("apikey");
    let model=localStorage.getItem("model");

    let city=document.getElementById("city").value;
    let weather=document.getElementById("weather").value;
    let now=new Date().toLocaleString();

    let sys=document.getElementById("systemPrompt").value;
    let bans=document.getElementById("banwords").value;

    let lastFive=history.slice(-5);

    let systemContent=`
å½“å‰æ—¶é—´:${now}
åŸå¸‚:${city}
å¤©æ°”:${weather}

${sys}

ç¦æ­¢ä½¿ç”¨è¯è¯­:${bans}
`;

    let messages=[
        {role:"system",content:systemContent},
        ...lastFive
    ];

    let res=await fetch(base,{
        method:"POST",
        headers:{
            "Content-Type":"application/json",
            "Authorization":"Bearer "+key
        },
        body:JSON.stringify({
            model:model,
            messages:messages,
            temperature:0.9
        })
    });

    let data=await res.json();
    let reply=data.choices[0].message.content;

    let lines=reply.split("\n").filter(l=>l.trim());

    lines.forEach(line=>{
        if(line.length>20) line=line.slice(0,20);
        addMsg(line,"other");
        history.push({role:"assistant",content:line});
    });
}
</script>

</body>
</html>
