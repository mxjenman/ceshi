<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI OS Desktop</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style id="custom-styles">
        /* ç”¨æˆ·ç¾åŒ–CSSå°†æ³¨å…¥æ­¤å¤„ */
    </style>
    <style>
        .cloud-bg {
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border-radius: 30px;
            padding: 20px;
            margin: 20px;
            box-shadow: 0 8px 32px rgba(31, 38, 135, 0.1);
        }
        .app-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .chat-bubble-ai { background-color: #95ec69; position: relative; }
        .chat-bubble-ai::before {
            content: ''; position: absolute; left: -10px; top: 10px;
            border: 5px solid transparent; border-right-color: #95ec69;
        }
    </style>
</head>
<body class="bg-gray-100 h-screen overflow-hidden">
<div id="app" class="h-full flex flex-col relative" :style="{ backgroundImage: 'url(' + settings.bgImage + ')', backgroundSize: 'cover' }">

    <div class="cloud-bg text-center text-gray-800">
        <div class="text-4xl font-light">{{ currentTime }}</div>
        <div class="text-sm mt-1">{{ currentDate }}</div>
        <div class="flex justify-center gap-2 mt-2 text-sm opacity-80">
            <span>{{ config.city }}</span>
            <span>{{ config.weather }}</span>
        </div>
    </div>

    <div class="flex-1 p-6">
        <div @click="openChat" class="flex flex-col items-center gap-2 w-20 cursor-pointer">
            <div class="app-icon text-3xl">ğŸ’¬</div>
            <span class="text-xs text-white drop-shadow-md">ç§èŠ</span>
        </div>
    </div>

    <div class="flex justify-around items-center p-4 bg-white/30 backdrop-blur-md pb-8">
        <button @click="ui.showSettings = true" class="flex flex-col items-center">
            <span class="text-2xl">âš™ï¸</span>
            <span class="text-[10px]">è®¾ç½®</span>
        </button>
        <button @click="ui.showStyle = true" class="flex flex-col items-center">
            <span class="text-2xl">ğŸ¨</span>
            <span class="text-[10px]">ç¾åŒ–</span>
        </button>
        <button @click="ui.showPreset = true" class="flex flex-col items-center">
            <span class="text-2xl">ğŸ“</span>
            <span class="text-[10px]">é¢„è®¾</span>
        </button>
    </div>

    <div v-if="ui.chatOpen" class="fixed inset-0 bg-[#ededed] flex flex-col z-50">
        <div class="p-4 bg-[#ededed] flex items-center border-b">
            <button @click="ui.chatOpen = false" class="mr-4 text-xl">â†</button>
            <span class="font-bold">æ™ºå‹</span>
        </div>
        
        <div class="flex-1 overflow-y-auto p-4 space-y-4" id="msg-container">
            <div v-for="msg in messages" :key="msg.id" :class="['flex', msg.role === 'user' ? 'justify-end' : 'justify-start']">
                <div :class="['max-w-[70%] p-2 rounded-lg text-sm shadow-sm', msg.role === 'user' ? 'bg-[#95ec69]' : 'bg-white']">
                    {{ msg.content }}
                </div>
            </div>
        </div>

        <div class="p-4 bg-white flex gap-2">
            <input v-model="userInput" @keyup.enter="sendMessage" type="text" class="flex-1 border rounded p-2 outline-none">
            <button @click="generateAI" class="bg-green-500 text-white px-4 py-2 rounded text-sm">ç”Ÿæˆ</button>
        </div>
    </div>

    <div v-if="ui.showSettings || ui.showStyle || ui.showPreset" class="fixed inset-0 bg-black/50 flex items-center justify-center z-[60] p-4">
        <div class="bg-white rounded-xl w-full max-w-md p-6 max-h-[80vh] overflow-y-auto">
            <h3 class="text-lg font-bold mb-4">åŠŸèƒ½é…ç½®</h3>
            
            <div v-if="ui.showSettings" class="space-y-3">
                <input v-model="config.baseUrl" placeholder="Base URL" class="w-full border p-2 rounded">
                <input v-model="config.apiKey" placeholder="API Key" type="password" class="w-full border p-2 rounded">
                <input v-model="config.model" placeholder="Model Name" class="w-full border p-2 rounded">
                <input v-model="config.city" placeholder="è®¾ç½®åŸå¸‚" class="w-full border p-2 rounded">
                <input v-model="config.weather" placeholder="è®¾ç½®å¤©æ°”" class="w-full border p-2 rounded">
            </div>

            <div v-if="ui.showStyle" class="space-y-3">
                <p class="text-xs text-gray-500">è¾“å…¥ CSS æ”¹å˜æ ·å¼</p>
                <textarea v-model="customCSS" class="w-full border p-2 rounded h-32 font-mono text-sm"></textarea>
            </div>

            <div v-if="ui.showPreset" class="space-y-3">
                <p class="text-xs text-gray-500">è§’è‰²æ‰®æ¼”/å›å¤è§„åˆ™ Prompt</p>
                <textarea v-model="config.systemPrompt" class="w-full border p-2 rounded h-32 text-sm"></textarea>
            </div>

            <div class="mt-6 flex justify-end gap-2">
                <button @click="closeModals" class="px-4 py-2">å–æ¶ˆ</button>
                <button @click="saveSettings" class="px-4 py-2 bg-blue-500 text-white rounded">ä¿å­˜</button>
            </div>
        </div>
    </div>
</div>

<script>
const { createApp, ref, onMounted, onUnmounted } = Vue;

createApp({
    setup() {
        const currentTime = ref('');
        const currentDate = ref('');
        const userInput = ref('');
        const customCSS = ref('');
        const messages = ref([]);
        
        const ui = ref({ chatOpen: false, showSettings: false, showStyle: false, showPreset: false });
        
        const config = ref({
            baseUrl: 'https://api.openai.com/v1',
            apiKey: '',
            model: 'gpt-3.5-turbo',
            city: 'ä¸Šæµ·',
            weather: 'æ™´å¤© 25Â°C',
            systemPrompt: 'ä½ æ˜¯ä¸€ä¸ªçœŸå®çš„å¾®ä¿¡å¥½å‹ï¼Œè¯´è¯ç®€çŸ­ã€éšæ€§ï¼Œä¸è¦åƒæœºå™¨äººã€‚'
        });

        const settings = ref({ bgImage: 'https://picsum.photos/1080/1920' });

        const updateTime = () => {
            const now = new Date();
            currentTime.value = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
            currentDate.value = now.toLocaleDateString([], { month: 'long', day: 'numeric', weekday: 'long' });
        };

        const sendMessage = () => {
            if (!userInput.value) return;
            messages.value.push({ id: Date.now(), role: 'user', content: userInput.value });
            userInput.value = '';
        };

        const generateAI = async () => {
            if (messages.value.length === 0) return;
            
            // è·å–æœ€è¿‘5æ¬¡å¯¹è¯
            const history = messages.value.slice(-5).map(m => ({ role: m.role, content: m.content }));
            
            // æ‹¼æ¥ç¯å¢ƒæ„ŸçŸ¥ä¿¡æ¯
            const contextPrompt = `\n[å½“å‰ç¯å¢ƒä¿¡æ¯] åŸå¸‚:${config.value.city}, å¤©æ°”:${config.value.weather}, æ—¶é—´:${currentTime.value}`;
            
            try {
                const response = await fetch(`${config.value.baseUrl}/chat/completions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${config.value.apiKey}`
                    },
                    body: JSON.stringify({
                        model: config.value.model,
                        messages: [
                            { role: 'system', content: config.value.systemPrompt + contextPrompt },
                            ...history
                        ],
                        temperature: 0.8
                    })
                });
                
                const data = await response.json();
                const reply = data.choices[0].message.content;
                
                // æ¨¡æ‹ŸçœŸäººåˆ†æ®µå›å¤
                const chunks = reply.split(/[ã€‚ï¼ï¼Ÿ]/).filter(s => s.trim().length > 0);
                chunks.forEach((text, index) => {
                    setTimeout(() => {
                        messages.value.push({ id: Date.now() + index, role: 'assistant', content: text.substring(0, 20) });
                    }, index * 1000 + 500);
                });

            } catch (e) {
                alert('APIè°ƒç”¨å¤±è´¥ï¼Œè¯·æ£€æŸ¥é…ç½®');
            }
        };

        const saveSettings = () => {
            document.getElementById('custom-styles').innerHTML = customCSS.value;
            closeModals();
        };

        const closeModals = () => {
            ui.value.showSettings = ui.value.showStyle = ui.value.showPreset = false;
        };

        onMounted(() => {
            updateTime();
            setInterval(updateTime, 1000);
        });

        return { currentTime, currentDate, config, ui, messages, userInput, generateAI, sendMessage, customCSS, saveSettings, closeModals, settings };
    }
}).mount('#app');
</script>
</body>
</html>
