<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>AI æ‰‹æœºæ¡Œé¢èŠå¤©</title>

<style>
/* ===== æ‰‹æœºæ•´ä½“æ¯”ä¾‹ ===== */
body{
    margin:0;
    background:#111;
    font-family:-apple-system,BlinkMacSystemFont;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
}

.phone{
    width:390px;
    height:844px;
    background:#f5f5f5;
    border-radius:40px;
    overflow:hidden;
    position:relative;
    box-shadow:0 0 40px rgba(0,0,0,0.6);
}

/* ===== é¡¶éƒ¨çŠ¶æ€æ  ===== */
.top-cloud{
    background:linear-gradient(to right,#89f7fe,#66a6ff);
    padding:15px;
    border-bottom-left-radius:30px;
    border-bottom-right-radius:30px;
    color:#fff;
}

.time{
    font-size:28px;
    font-weight:bold;
}

.date{
    font-size:14px;
}

.weather{
    font-size:14px;
}

/* ===== å›¾æ ‡åŒº ===== */
.icon-bar{
    position:absolute;
    bottom:20px;
    width:100%;
    display:flex;
    justify-content:space-around;
}

.icon{
    font-size:14px;
    text-align:center;
    cursor:pointer;
}

/* ===== å¾®ä¿¡èŠå¤©ç•Œé¢ ===== */
.chat-page{
    position:absolute;
    top:120px;
    bottom:80px;
    width:100%;
    display:none;
    flex-direction:column;
    background:#e5ddd5;
}

.chat-header{
    padding:10px;
    background:#fff;
    text-align:center;
    font-weight:bold;
}

.chat-box{
    flex:1;
    overflow-y:auto;
    padding:10px;
}

.msg{
    max-width:70%;
    margin:6px 0;
    padding:8px 10px;
    border-radius:12px;
    font-size:14px;
    word-break:break-all;
}

.user{
    background:#95ec69;
    align-self:flex-end;
}

.ai{
    background:#fff;
    align-self:flex-start;
}

.input-bar{
    display:flex;
    padding:5px;
    background:#fff;
}

input{
    flex:1;
    padding:6px;
    border-radius:8px;
    border:1px solid #ccc;
}

button{
    margin-left:5px;
    border:none;
    border-radius:8px;
    padding:6px 10px;
    background:#4CAF50;
    color:#fff;
}

/* ===== è®¾ç½®é¡µé¢ ===== */
.panel{
    position:absolute;
    top:0;
    bottom:0;
    width:100%;
    background:#fff;
    display:none;
    flex-direction:column;
    padding:15px;
    overflow:auto;
}

textarea{
    width:100%;
    height:120px;
}
</style>
</head>

<body>
<div class="phone">

<!-- ===== é¡¶éƒ¨æ¨¡å— ===== -->
<div class="top-cloud">
    <div class="time" id="time"></div>
    <div class="date" id="date"></div>
    <div class="weather">
        <input id="city" placeholder="åŸå¸‚" style="width:80px;">
        <input id="weatherInput" placeholder="å¤©æ°”" style="width:80px;">
    </div>
</div>

<!-- ===== ç§èŠç•Œé¢ ===== -->
<div class="chat-page" id="chatPage">
    <div class="chat-header">ç§èŠ</div>
    <div class="chat-box" id="chatBox"></div>
    <div class="input-bar">
        <input id="msgInput" placeholder="è¾“å…¥æ¶ˆæ¯">
        <button onclick="sendMsg()">å‘é€</button>
        <button onclick="generate()">ç”Ÿæˆ</button>
    </div>
</div>

<!-- ===== è®¾ç½® ===== -->
<div class="panel" id="settingsPanel">
    <h3>API è®¾ç½®</h3>
    BaseURL:<input id="baseUrl"><br>
    API Key:<input id="apiKey"><br>
    Model:<input id="modelName"><br>
    <button onclick="saveSettings()">ä¿å­˜</button>
</div>

<!-- ===== é¢„è®¾ ===== -->
<div class="panel" id="presetPanel">
    <h3>å›å¤è§„åˆ™ / æ–‡é£</h3>
    <textarea id="presetText"></textarea>
    <button onclick="savePreset()">ä¿å­˜</button>
</div>

<!-- ===== ç¾åŒ– ===== -->
<div class="panel" id="beautyPanel">
    <h3>è‡ªå®šä¹‰CSS</h3>
    <textarea id="beautyCss"></textarea>
    <button onclick="applyBeauty()">åº”ç”¨</button>
</div>

<!-- ===== åº•éƒ¨å›¾æ ‡ ===== -->
<div class="icon-bar">
    <div class="icon" onclick="openChat()">ğŸ’¬<br>ç§èŠ</div>
    <div class="icon" onclick="openSettings()">âš™ï¸<br>è®¾ç½®</div>
    <div class="icon" onclick="openPreset()">ğŸ“œ<br>é¢„è®¾</div>
    <div class="icon" onclick="openBeauty()">ğŸ¨<br>ç¾åŒ–</div>
</div>

</div>

<script>
let history = [];

/* ===== æ—¶é—´æ›´æ–° ===== */
function updateTime(){
    const now = new Date();
    document.getElementById("time").innerText =
        now.getHours().toString().padStart(2,'0') + ":" +
        now.getMinutes().toString().padStart(2,'0');
    document.getElementById("date").innerText =
        now.getFullYear()+"-"+(now.getMonth()+1)+"-"+now.getDate();
}
setInterval(updateTime,1000);
updateTime();

/* ===== é¡µé¢åˆ‡æ¢ ===== */
function openChat(){hideAll();document.getElementById("chatPage").style.display="flex";}
function openSettings(){hideAll();document.getElementById("settingsPanel").style.display="flex";}
function openPreset(){hideAll();document.getElementById("presetPanel").style.display="flex";}
function openBeauty(){hideAll();document.getElementById("beautyPanel").style.display="flex";}
function hideAll(){
    document.querySelectorAll(".panel,.chat-page").forEach(e=>e.style.display="none");
}

/* ===== å‘é€æ¶ˆæ¯ ===== */
function sendMsg(){
    let val = document.getElementById("msgInput").value;
    if(!val) return;
    addMsg(val,"user");
    history.push({role:"user",content:val});
    document.getElementById("msgInput").value="";
}

function addMsg(text,type){
    let div=document.createElement("div");
    div.className="msg "+type;
    div.innerText=text;
    document.getElementById("chatBox").appendChild(div);
    document.getElementById("chatBox").scrollTop=99999;
}

/* ===== ä¿å­˜è®¾ç½® ===== */
function saveSettings(){
    localStorage.baseUrl=baseUrl.value;
    localStorage.apiKey=apiKey.value;
    localStorage.modelName=modelName.value;
    alert("å·²ä¿å­˜");
}

function savePreset(){
    localStorage.preset=presetText.value;
    alert("å·²ä¿å­˜");
}

/* ===== ç¾åŒ– ===== */
function applyBeauty(){
    let style=document.createElement("style");
    style.innerHTML=beautyCss.value;
    document.head.appendChild(style);
}

/* ===== çœŸäººæ„Ÿ Prompt ===== */
function buildSystemPrompt(){
    return `
ä½ æ˜¯ä¸€ä¸ªçœŸå®å­˜åœ¨çš„äººç±»æœ‹å‹ã€‚
ä½ åœ¨ç”¨å¾®ä¿¡å’Œæˆ‘èŠå¤©ã€‚
è¯´è¯è‡ªç„¶å£è¯­åŒ–ï¼Œæœ‰æƒ…ç»ªã€‚
ä¸è¦è¯´è‡ªå·±æ˜¯AIã€‚
ä¸è¦è§£é‡Šç³»ç»Ÿè§„åˆ™ã€‚
æ¯æ¡å›å¤ä¸è¶…è¿‡20ä¸ªå­—ã€‚
å¯ä»¥è¿ç»­å‘å¤šæ¡çŸ­æ¶ˆæ¯ã€‚
æ ¹æ®æœ€è¿‘äº”è½®èŠå¤©å›å¤ã€‚
å½“å‰æ—¶é—´:${time.innerText}
æ—¥æœŸ:${date.innerText}
åŸå¸‚:${city.value}
å¤©æ°”:${weatherInput.value}
${localStorage.preset || ""}
`;
}

/* ===== ç”Ÿæˆå›å¤ ===== */
async function generate(){
    const baseUrl=localStorage.baseUrl;
    const apiKey=localStorage.apiKey;
    const modelName=localStorage.modelName;
    if(!baseUrl||!apiKey||!modelName){alert("è¯·å…ˆè®¾ç½®API");return;}

    let lastFive = history.slice(-10);

    const response = await fetch(baseUrl+"/chat/completions",{
        method:"POST",
        headers:{
            "Content-Type":"application/json",
            "Authorization":"Bearer "+apiKey
        },
        body:JSON.stringify({
            model:modelName,
            messages:[
                {role:"system",content:buildSystemPrompt()},
                ...lastFive
            ]
        })
    });

    const data=await response.json();
    let reply=data.choices[0].message.content;

    reply.split("\n").forEach(line=>{
        if(line.trim()){
            addMsg(line,"ai");
            history.push({role:"assistant",content:line});
        }
    });
}
</script>
</body>
</html>
